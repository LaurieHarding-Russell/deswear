#include <algorithm>
#include <stdio.h>
#include <string>
#include <cstring>
#include <array>

#include <iostream>
#include "git2.h"


bool containsSwear(const char * summary) {

    std::array<std::string, 3> swears = {{
        "shit", "damn", "fuck"
    }};

    std::string commitMessage = summary;

    std::transform(commitMessage.begin(), commitMessage.end(), commitMessage.begin(), ::tolower);

    for (uint i = 0; i != swears.size(); i++) {
        if(std::strstr(commitMessage.c_str(), swears[i].c_str()) != NULL) {
            return true;
        }
    }
    return false;
}

int main() {

    const char * REPO_LOCATION = "/home/laurie/test";
    git_libgit2_init();

    git_repository *repo = NULL;
    git_diff_options diffopts = GIT_DIFF_OPTIONS_INIT;

    int error = git_repository_open(&repo, REPO_LOCATION);
    if (error < 0) {    
        const git_error *e = giterr_last();
        printf("Error %d/%d: %s\n", error, e->klass, e->message);
        exit(error);
    }

    git_oid oid;

    git_revwalk *walker;
    git_revwalk_new(&walker, repo);
    git_revwalk_push_head(walker);
    
    while(!git_revwalk_next(&oid, walker)) {
        git_commit *commit = NULL;
		git_commit_lookup(&commit, repo, &oid);

        const char * summary = git_commit_summary(commit);

        if (containsSwear(summary)) {
            std::cout << git_oid_tostr_s(&oid) << " " << git_commit_summary(commit) << std::endl; 
        }
        
		git_commit_free(commit);
    }

    git_revwalk_free(walker);
    git_repository_free(repo);


    git_libgit2_shutdown();
    return 0;
}